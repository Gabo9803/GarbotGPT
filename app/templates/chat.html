{% extends "base.html" %}
{% block title %}Chat with GarBotGPT{% endblock %}
{% block content %}
<body data-authenticated="{{ authenticated | lower }}">
<div class="chat-container card shadow-lg border-0" id="chat-container-main">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0">Chat with GarBotGPT</h2>
        <div>
            <button id="fullscreen-toggle" class="btn btn-outline-secondary btn-sm me-2" title="Toggle Fullscreen">
                <i class="bi bi-arrows-fullscreen"></i>
            </button>
            <button id="clear-history" class="btn btn-outline-danger btn-sm">Clear History</button>
        </div>
    </div>
    <div id="chat-messages" class="card-body">
        {% for entry in history %}
            <div class="message user-message animate__animated animate__fadeIn">
                <strong>You:</strong>
                <div class="message-content">{{ entry.message | safe }}</div>
            </div>
            <div class="message ai-message animate__animated animate__fadeIn">
                <strong>GarBotGPT:</strong>
                <div class="message-content markdown-body">{{ entry.response | safe }}</div>
                <button class="copy-btn btn btn-sm btn-outline-secondary mt-1" data-text="{{ entry.response }}">Copy</button>
            </div>
        {% endfor %}
        <div id="responding-indicator" class="message ai-message animate__animated animate__fadeIn d-none">
            <strong>GarBotGPT:</strong>
            <div class="message-content">Respondiendo<span class="dots"></span></div>
        </div>
    </div>
    <div class="card-footer">
        <div class="input-group">
            <input type="text" id="message" class="form-control" placeholder="Type your message..." autocomplete="off">
            <button class="btn btn-primary btn-gradient" onclick="sendMessage()">Send</button>
        </div>
        <div class="chat-options mt-2">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="send-on-enter" checked>
                <label class="form-check-label" for="send-on-enter">Send on Enter</label>
            </div>
            <button id="regenerate-response" class="btn btn-outline-secondary btn-sm">Regenerate Response</button>
            <a href="{{ url_for('export_history') }}" class="btn btn-outline-secondary btn-sm">Export History</a>
        </div>
    </div>
</div>
<script>
    document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
</script>
</body>
{% endblock %}