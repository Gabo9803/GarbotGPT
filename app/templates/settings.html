{% extends "base.html" %}
{% block title %}Configuració - GarBotGPT{% endblock %}
{% block content %}
<section class="py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-0 animate__animated animate__fadeIn">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">Configuració</h2>
                    <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="true">Perfil</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chat" type="button" role="tab" aria-controls="chat" aria-selected="false">Xat</button>
                        </li>
                    </ul>
                    <form method="POST" id="settings-form" novalidate>
                        <div class="tab-content" id="settingsTabContent">
                            <!-- Perfil -->
                            <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                <div class="mb-3">
                                    <label for="username" class="form-label">Nom d'usuari</label>
                                    <input type="text" class="form-control" id="username" name="username" value="{{ current_user.username }}" required>
                                    <div class="invalid-feedback">El nom d'usuari és obligatori.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="password" class="form-label">Nova contrasenya (deixa en blanc per mantenir l'actual)</label>
                                    <input type="password" class="form-control" id="password" name="password">
                                </div>
                                <div class="mb-3">
                                    <label for="theme" class="form-label">Tema</label>
                                    <select class="form-select" id="theme" name="theme">
                                        <option value="light" {% if current_user.theme == 'light' %}selected{% endif %}>Clar</option>
                                        <option value="dark" {% if current_user.theme == 'dark' %}selected{% endif %}>Fosc</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Xat -->
                            <div class="tab-pane fade" id="chat" role="tabpanel" aria-labelledby="chat-tab">
                                <div class="mb-3">
                                    <label for="model" class="form-label">Model d'IA</label>
                                    <select class="form-select" id="model" name="model">
                                        <option value="gpt-3.5-turbo" {% if chat_settings.model == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo</option>
                                        <option value="gpt-4" {% if chat_settings.model == 'gpt-4' %}selected{% endif %}>GPT-4</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="temperature" class="form-label">Temperatura (0.0 a 1.0)</label>
                                    <input type="number" class="form-control" id="temperature" name="temperature" step="0.1" min="0" max="1" value="{{ chat_settings.temperature }}" required>
                                    <div class="invalid-feedback">Introdueix un valor entre 0 i 1.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="max_tokens" class="form-label">Màxim de tokens (100 a 2000)</label>
                                    <input type="number" class="form-control" id="max_tokens" name="max_tokens" min="100" max="2000" value="{{ chat_settings.max_tokens }}" required>
                                    <div class="invalid-feedback">Introdueix un valor entre 100 i 2000.</div>
                                </div>
                            </div>
                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-gradient">Desa la configuració</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    // Validació del formulari al client
    document.getElementById('settings-form').addEventListener('submit', function(event) {
        const form = this;
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
</script>
{% endblock %}